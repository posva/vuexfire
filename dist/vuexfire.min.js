/*!
 * vuexfire v2.1.3
 * (c) 2017 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.VuexFire=e.VuexFire||{})}(this,function(e){"use strict";function n(e,n){for(var t=0;t<e.length;t++)if(e[t][".key"]===n)return t;return-1}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){return"function"==typeof e.key?e.key():e.key}function i(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function c(e){var n=e.val(),i=t(n)?n:{".value":n};return i[".key"]=r(e),i}function o(e,n){return e.findIndex(function(e){return t(e)?e[".key"]===n[".key"]:e===n})}function a(e){var n=e.key,t=e.source,r=e.cancelCallback,i=e.commit,o=e.state;return{value:t.on("value",function(e){i(d,{type:d,key:n,record:c(e),state:o},E)},r)}}function u(e){var t=e.key,i=e.source,o=e.cancelCallback,a=e.commit,u=e.state,s=[].concat(u[t]),f=i.on("child_added",function(e,r){var i=u[t],o=r?n(i,r)+1:0;a(l,{type:l,state:u,key:t,index:o,initArray:s,record:c(e)},E)},o),d=i.on("child_removed",function(e){var i=n(u[t],r(e));a(k,{type:k,state:u,key:t,index:i},E)},o);return{child_added:f,child_changed:i.on("child_changed",function(e){var i=n(u[t],r(e));a(y,{type:y,state:u,key:t,index:i,record:c(e)},E)},o),child_removed:d,child_moved:i.on("child_moved",function(e,i){var o=u[t],s=n(o,r(e)),f=i?n(o,i)+1:0;a(v,{type:v,state:u,key:t,index:s,newIndex:f+=s<f?-1:0,record:c(e)},E)},o)}}function s(e){var n=e.state,r=e.commit,c=e.key,o=e.source,s=e.options,d=s.cancelCallback,l=s.readyCallback;if(!t(o))throw new Error("VuexFire: invalid Firebase binding source.");if(!(c in n))throw new Error("VuexFire: cannot bind undefined property '"+c+"'. Define it on the state first.");var y=A.get(r);y||(y={sources:Object.create(null),listeners:Object.create(null)},A.set(r,y)),c in y.sources&&f({commit:r,key:c}),y.sources[c]=i(o);var v;v=n[c]&&"length"in n[c]?u({key:c,source:o,cancelCallback:d,commit:r,state:n}):a({key:c,source:o,cancelCallback:d,commit:r,state:n}),y.listeners[c]=v,l&&o.once("value",l)}function f(e){var n=e.commit,t=e.key,r=A.get(n);if(r||(r={sources:Object.create(null),listeners:Object.create(null)},A.set(n,r)),!(t in r.sources))throw new Error("VuexFire: cannot unbind '"+t+"' because it wasn't bound.");var i=r.sources[t],c=r.listeners[t];for(var o in c)i.off(o,c[o]);delete r.sources[t],delete r.listeners[t]}var d="vuexfire/OBJECT_VALUE",l="vuexfire/ARRAY_ADD",y="vuexfire/ARRAY_CHANGE",v="vuexfire/ARRAY_MOVE",k="vuexfire/ARRAY_REMOVE",b=Object.freeze({VUEXFIRE_OBJECT_VALUE:d,VUEXFIRE_ARRAY_ADD:l,VUEXFIRE_ARRAY_CHANGE:y,VUEXFIRE_ARRAY_MOVE:v,VUEXFIRE_ARRAY_REMOVE:k}),p={};p[d]=function(e,n){var t=n.key,r=n.record;e[t]=r},p[l]=function(e,n){var t=n.key,r=n.index,i=n.initArray,c=n.record;if(i.length<1)e[t].splice(r,0,c);else{var a=o(i,c);i.splice(a,1),r=o(e[t],c),e[t].splice(r,1,c)}},p[y]=function(e,n){var t=n.key,r=n.index,i=n.record;e[t].splice(r,1,i)},p[v]=function(e,n){var t=n.key,r=n.index,i=(n.record,n.newIndex),c=e[t];c.splice(i,0,c.splice(r,1)[0])},p[k]=function(e,n){var t=n.key,r=n.index;e[t].splice(r,1)};var m={};Object.keys(b).forEach(function(e){var n=b[e];m[n]=function(e,t){p[n](t.state,t)}});var E={root:!0},A=new WeakMap;e.firebaseMutations=m,e.firebaseAction=function(e){return function(n,t){var r=n.state,i=n.commit;return n.bindFirebaseRef=function(e,n,t){return void 0===t&&(t={}),s({state:r,commit:i,key:e,source:n,options:t})},n.unbindFirebaseRef=function(e){return f({commit:i,key:e})},e(n,t)}},Object.defineProperty(e,"__esModule",{value:!0})});